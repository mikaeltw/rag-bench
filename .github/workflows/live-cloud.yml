name: live-cloud
on:
  schedule: [{ cron: '0 3 * * *' }]
  workflow_dispatch: {}
jobs:
  gcp-vertex:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: { python-version: '3.11' }
      - name: Install
        run: |
          python -m pip install -U pip
          pip install -e ".[gcp]"
      - name: ADC auth
        if: env.GOOGLE_CREDENTIALS_JSON != ''
        run: |
          echo "$GOOGLE_CREDENTIALS_JSON" > $HOME/gcp.json
          echo "GOOGLE_APPLICATION_CREDENTIALS=$HOME/gcp.json" >> $GITHUB_ENV
        env:
          GOOGLE_CREDENTIALS_JSON: ${{ secrets.GOOGLE_CREDENTIALS_JSON }}
      - name: Tests
        env:
          RUN_GCP_SMOKE: 'true'
          GCP_PROJECT: ${{ secrets.GCP_PROJECT }}
          VERTEX_LOCATION: ${{ secrets.VERTEX_LOCATION }}
          VERTEX_CHAT_MODEL: ${{ secrets.VERTEX_CHAT_MODEL }}
        run: pytest -q -m cloud tests/cloud/test_gcp_vertex_smoke.py
